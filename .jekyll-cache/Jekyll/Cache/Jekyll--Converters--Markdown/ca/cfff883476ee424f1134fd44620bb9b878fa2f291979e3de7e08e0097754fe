I"<p>##</p>

<h2 id="ex">Ex</h2>

<pre><code class="language-C#">using System;
using System.Threading;

namespace aa
{
    public delegate void MyDelegate(AutoResetEvent ev);

    public class Example
    {

        public static AutoResetEvent MainEv = new AutoResetEvent(false);

        public static void AddPrintJob(AutoResetEvent ev)
        {
            Console.WriteLine("í”„ë¦°í„° ì¸ì‡„ê°€ ìš”ì²­ë˜ì—ˆìŠµë‹ˆë‹¤.");
            ev.Set();
            Thread.Sleep(3000);
        }

        static void Main(string[] args)
        {
            Console.WriteLine("Typress Server ì‹œì‘\n");

            MyPrinter p = new MyPrinter();
            p.PrintRequest += new MyDelegate(AddPrintJob);

            ThreadStart p1 = new ThreadStart(p.WaitPrintRequest);
            Console.WriteLine("Printer Service ì‹œì‘");

            ThreadStart p2 = new ThreadStart(p.PushPrintRequest); // ì™¸ë¶€ ì´ë²¤íŠ¸
            Thread p_1 = new Thread(p1);
            Thread p_2 = new Thread(p2);
            p_1.Start();
            p_2.Start();

            MainEv.WaitOne(); // p1ì´ ì¢…ë£Œë˜ëŠ” ì´ë²¤íŠ¸ !!

            MyPrinter.PushEv.Reset();
            MyPrinter.PushFlag = false;
            Console.WriteLine("Typress Server ì¢…ë£Œ\n");
        }
    }

    public class TaskInfo
    {
        public RegisteredWaitHandle Handle = null;
        public string OtherInfo = "default";
    }

    class MyPrinter
    {
        public event MyDelegate PrintRequest;
        public static AutoResetEvent PrintEv = new AutoResetEvent(false);
        public static ManualResetEvent PushEv = new ManualResetEvent(true);
        public static bool PushFlag = true;
        public AutoResetEvent ev = new AutoResetEvent(false);
        // Print ëŒ€ê¸°.
        // Print ë“¤ì–´ì™”ìŒ -&gt; ë¡œê·¸ì¸ ì¸ì¦, ì™„ë£Œí•˜ë©´ ë‹¤ì‹œ ëŒ€ê¸°.  
        public void WaitPrintRequest()
        {
            TaskInfo ti = new TaskInfo();
            ti.OtherInfo = "Printer Open";

            Console.WriteLine("WaitProc( {0} ) executes on thread {1}; cause = YET",
                ti.OtherInfo,
                Thread.CurrentThread.GetHashCode().ToString());
            ti.Handle = ThreadPool.RegisterWaitForSingleObject(ev, new WaitOrTimerCallback(WaitProc), ti, 1000, false);


            PrintEv.WaitOne();

            Console.WriteLine("Main Thread ì§„í–‰");
            Thread.Sleep(1000);
            Example.MainEv.Set();
        }
        public void PushPrintRequest()
        {
            while (PushFlag &amp;&amp; PushEv.WaitOne())
            {
                Console.ReadLine();
                PrintRequest(ev);
            }
            Console.WriteLine("Push ì¢…ë£Œ!");
        }

        public static void WaitProc(object state, bool timedOut)
        {
            // The state object must be cast to the correct type, because the
            // signature of the WaitOrTimerCallback delegate specifies type
            // Object.
            TaskInfo ti = (TaskInfo)state;

            ti.OtherInfo = "Printer Waiting";
            string cause = "No Printer Request";
            if (!timedOut)
            {
                cause = "Add Print Job!!";
                // If the callback method executes because the WaitHandle is
                // signaled, stop future execution of the callback method
                // by unregistering the WaitHandle.
                if (ti.Handle != null)
                {
                    Console.WriteLine("Typress Auth!");
                    ti.Handle.Unregister(null);
                    PrintEv.Set();
                }
            }

            Console.WriteLine("WaitProc( {0} ) executes on thread {1}; cause = {2}.",
                ti.OtherInfo,
                Thread.CurrentThread.GetHashCode().ToString(),
                cause
            );
        }
    }
}




</code></pre>

<hr />

:ET